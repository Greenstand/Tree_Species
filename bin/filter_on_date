#!/usr/bin/gawk -f

BEGIN{
  FS=OFS="|"
  if (ARGC != 4 ||                                      \
      (ARGV[1] !~ /^[0-9]+$/) ||                        \
      (ARGV[2] !~ /^[0-9]{4}-[0-9]{2}-[0-9]{2}$/)) {
    print "Usage: filter_on_date <col> <date> <file>"
    exit 1
  }

  while ((getline < ARGV[3])>0) {
    if ($ARGV[1] ~ /^[0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2}\.[0-9]+$/)
      {
  # 2022-02-03 19:13:37.531591
  if (mktime(gensub(/^([0-9]{4})-([0-9]{2})-([0-9]{2}) ([0-9]{2}):([0-9]{2}):([0-9]{2}).*$/,"\\1 \\2 \\3 \\4 \\5 \\6","G",$ARGV[1])) > \
      mktime(gensub(/^([0-9]{4})-([0-9]{2})-([0-9]{2}).*$/,"\\1 \\2 \\3 00 00 00","G",ARGV[2])))
    print $0
      }
  }
}
